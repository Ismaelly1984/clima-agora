<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Como Funciona | Clima Agora</title>
    <meta name="description" content="Entenda a arquitetura do Clima Agora: SPA em HTML/CSS/JS, PWA com Service Worker, proxy serverless para esconder a API key, caching e segurança." />
    <meta property="og:title" content="Como Funciona – Clima Agora" />
    <meta property="og:description" content="Front-end leve, PWA robusto, proxy serverless e boas práticas de segurança." />
    <meta property="og:image" content="https://clima-agora.vercel.app/assets/og-image.png" />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://clima-agora.vercel.app/como-funciona.html" />
    <meta http-equiv="Content-Security-Policy"
          content="
      default-src 'self';
      connect-src 'self' https://fonts.googleapis.com https://fonts.gstatic.com;
      img-src 'self' data: https://openweathermap.org https://openweathermap.org/img/wn;
      style-src 'self' 'unsafe-inline' https://fonts.googleapis.com;
      font-src 'self' https://fonts.gstatic.com data:;
      script-src 'self';
      frame-ancestors 'none';
      base-uri 'self';
      upgrade-insecure-requests;">
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Como Funciona – Clima Agora" />
    <meta name="twitter:description" content="Arquitetura, PWA e segurança do Clima Agora." />
    <meta name="twitter:image" content="https://clima-agora.vercel.app/assets/og-image.png" />
    <meta property="og:image:alt" content="Como funciona • Clima Agora" />
    <meta name="twitter:image:alt" content="Como funciona • Clima Agora" />
    <link rel="canonical" href="https://clima-agora.vercel.app/como-funciona.html" />
    <meta name="robots" content="index,follow" />
    <meta name="theme-color" content="#0f172a" />
    <meta property="og:site_name" content="Clima Agora" />
    <meta property="og:locale" content="pt_BR" />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" />
    <link rel="manifest" href="manifest.webmanifest" />
    <link rel="icon" href="assets/icons/favicon.svg" type="image/svg+xml" />
    <link rel="apple-touch-icon" href="assets/icons/apple-touch-icon.png" />
    <link rel="stylesheet" href="style.min.css?v=1.0.7" />
    <link rel="stylesheet" href="extras.css?v=1.0.7" />

    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "WebPage",
        "name": "Como Funciona – Clima Agora",
        "url": "https://clima-agora.vercel.app/como-funciona.html",
        "description": "Arquitetura do Clima Agora: SPA, PWA, proxy serverless e segurança."
      }
    </script>
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "BreadcrumbList",
        "itemListElement": [
          {"@type": "ListItem", "position": 1, "name": "Início", "item": "https://clima-agora.vercel.app/"},
          {"@type": "ListItem", "position": 2, "name": "Como funciona", "item": "https://clima-agora.vercel.app/como-funciona.html"}
        ]
      }
    </script>
  </head>
  <body class="theme-auto">
    <a href="#main" class="skip-link">Pular para o conteúdo</a>
    <div class="overlay" aria-hidden="true"></div>

    <header class="site-header">
      <div class="brand">
        <svg class="brand-icon" aria-hidden="true" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><use href="assets/icons/sprite.svg#i-sun"/></svg>
        <h1 class="brand-title">Clima Agora</h1>
      </div>
      <nav aria-label="Navegação principal">
        <a class="secondary-btn" href="index.html">Início</a>
        <a class="secondary-btn" href="previsao.html">Previsão</a>
        <a class="secondary-btn" href="cidades.html">Cidades</a>
        <a class="secondary-btn" href="como-funciona.html" aria-current="page">Como funciona</a>
        <a class="secondary-btn" href="instalar.html">Instalar</a>
        <a class="secondary-btn" href="privacidade.html">Privacidade</a>
        <a class="secondary-btn" href="sobre.html">Sobre</a>
        <button id="themeToggle" class="secondary-btn" type="button" aria-label="Alternar tema">
          <svg aria-hidden="true" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><use href="assets/icons/sprite.svg#i-moon"/></svg>
          <span>Tema</span>
        </button>
      </nav>
      <button id="menuToggle" class="icon-btn" aria-label="Abrir menu" aria-expanded="false">
        <svg aria-hidden="true" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18M3 12h18M3 18h18"/></svg>
      </button>
      
    </header>

    <main id="main" class="container" role="main">
      <section class="glass" style="padding:16px">
        <h1>Arquitetura do Clima Agora</h1>
        <p>
          O Clima Agora foi projetado para ser <strong>leve</strong>, <strong>seguro</strong> e <strong>rápido</strong>. Do lado do cliente, é uma <strong>SPA</strong> em HTML/CSS/JS puro, com design fluidamente responsivo e foco em acessibilidade. Do lado do servidor, utiliza <strong>funções serverless</strong> para atuar como <strong>proxy</strong> de chamadas à OpenWeather, mantendo a <strong>API key</strong> em <em>variáveis de ambiente</em>, fora do navegador. Além disso, o app é um <strong>PWA</strong>, com Service Worker para cache do shell, navegação com <em>preload</em> e fallback offline.
        </p>
        <h2>Front-end</h2>
        <p>
          A interface aplica <em>glassmorphism</em>, <em>scroll-snap</em> em carrosséis, <em>skeletons</em> para carregamento e um <strong>CSS crítico</strong> inline mínimo para reduzir o <em>Largest Contentful Paint</em>. A previsão de 3h e 5 dias é carregada em <em>idle</em>, ou seja, após o primeiro paint, diminuindo o <em>Total Blocking Time</em>. Fontes do sistema têm prioridade para o primeiro paint e Poppins entra como melhoria (<em>swap</em>), equilibrando identidade visual e performance.
        </p>
        <h2>PWA e Service Worker</h2>
        <p>
          O Service Worker realiza <strong>pré‑cache</strong> do shell (HTML/CSS/JS minificados), habilita <strong>navigation preload</strong> e implementa uma navegação <em>network-first</em> com <em>fallback offline</em>. Há um <strong>banner de atualização</strong> para aplicar novas versões (skipWaiting/controllerchange) e um botão “Instalar” controlado por <em>beforeinstallprompt</em>, de acordo com as melhores práticas de UX.
        </p>
        <h2>Proxy serverless e segurança</h2>
        <p>
          As rotas <code>/api/weather</code> e <code>/api/forecast</code> executam no servidor e leem <code>OPENWEATHER_API_KEY</code> via <strong>variáveis de ambiente</strong>. O front‑end nunca expõe a chave. A interface é protegida por <strong>CSP</strong>, <strong>sanitização</strong> ao renderizar histórico e cards, e uso de <strong>headers</strong> no deploy (HSTS, X-Content-Type-Options, etc.). Assim reduzimos a superfície de ataque contra XSS e afins.
        </p>
        <h2>Caching e performance</h2>
        <p>
          O proxy usa cabeçalhos de cache (<code>s-maxage</code> e <code>stale-while-revalidate</code>) para melhorar a latência em borda/CDN. Imagens de fundo são convertidas para <strong>WebP</strong> e limitadas em tamanho; ícones meteorológicos são carregados de forma eficiente; e o CSS/JS é <strong>minificado</strong> com <em>cache busting</em>. O resultado é uma experiência muito próxima de <strong>100/100</strong> no Lighthouse.
        </p>
        <p>Para saber como interpretar a previsão, veja <a href="previsao.html">Previsão</a>. Para instalar o app, veja <a href="instalar.html">Instalar</a>.</p>
      </section>
    </main>

    <footer class="container" style="padding:12px 16px 36px;color:var(--text-muted);display:flex;gap:12px;flex-wrap:wrap;align-items:center">
      <span>© 2025 Clima Agora · Desenvolvido por Ismael Nunes · <a href="privacidade.html">Privacidade</a></span>
      <button class="install-cta hidden" type="button" data-install aria-label="Instalar aplicativo">
        <svg aria-hidden="true" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><use href="assets/icons/sprite.svg#i-download"/></svg>
        <span>Instalar app</span>
      </button>
    </footer>

    <div id="navBackdrop" class="nav-backdrop"></div>
    <aside id="mobileNav" class="mobile-nav hidden" aria-hidden="true">
      <nav aria-label="Menu móvel">
        <a class="secondary-btn" href="index.html">Início</a>
        <a class="secondary-btn" href="previsao.html">Previsão</a>
        <a class="secondary-btn" href="cidades.html">Cidades</a>
        <a class="secondary-btn" href="como-funciona.html" aria-current="page">Como funciona</a>
        <a class="secondary-btn" href="instalar.html">Instalar</a>
        <a class="secondary-btn" href="privacidade.html">Privacidade</a>
        <a class="secondary-btn" href="sobre.html">Sobre</a>
        <button class="secondary-btn" type="button" data-theme-toggle aria-label="Alternar tema">
          <svg aria-hidden="true" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><use href="assets/icons/sprite.svg#i-moon"/></svg>
          <span>Alternar tema</span>
        </button>
        <button class="secondary-btn hidden" type="button" data-install aria-label="Instalar aplicativo">
          <svg aria-hidden="true" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><use href="assets/icons/sprite.svg#i-download"/></svg>
          <span>Instalar app</span>
        </button>
      </nav>
    </aside>

    <script src="script.js?v=1.0.9" defer></script>
  </body>
  </html>
